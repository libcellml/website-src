name: Deploy libCellML website
on:
  push:
    branches:
      - production
      - staging
jobs:
  github-deploy:
    name: Deploying website
    runs-on: ubuntu-20.04
    steps:
      - name: Setup Node.js for use with actions
        uses: actions/setup-node@v1.4.4
        with:
          node-version: 17.x

      - name: Checkout branch
        uses: actions/checkout@v2

      - name: Clean install dependencies
        run: |
          yarn
          yarn add --dev execa

      - name: Run deploy script
        env:
          VITE_APP_ENCRYPTED_GITHUB_TOKEN: ${{ secrets.VUE_APP_ENCRYPTED_GITHUB_TOKEN }}
          BOT_ACCESS_TOKEN: ${{ secrets.BOT_ACCESS_TOKEN }}
        run: |
          git config user.name hsorby && git config user.email h.sorby@auckland.ac.nz
          if [ "${{ github.ref }}" = "refs/heads/staging" ]; then
            staging="-- staging"
          endif
          npm run github-deploy $staging
